<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Love Story of Frank & YellowEastSun</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&display=swap" rel="stylesheet">

<style>
:root { --p:#ff2d55; --s:#ffcc00; --bg:#050505; }
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);font-family:'Cinzel',serif}
canvas{position:fixed;inset:0;z-index:1;pointer-events:none}

/* ---------- Overlay / Cover ---------- */
#overlay{
position:fixed;inset:0;z-index:999;
display:flex;align-items:center;justify-content:center;
background:#000;cursor:pointer;
transition:opacity 1.2s ease
}
.cover{text-align:center;color:#fff;letter-spacing:6px}
.cover .l1{font-size:1.8rem}
.cover .l2{font-size:.8rem;margin:12px 0;opacity:.6;letter-spacing:4px}
.cover .l3{font-size:1.2rem}
.cover span{position:relative;display:inline-block}

@keyframes shimmer{
0%{background-position:-200%}
100%{background-position:200%}
}
.cover span::after{
content:"";position:absolute;inset:0;
background:linear-gradient(120deg,transparent,rgba(255,255,255,.7),transparent);
background-size:200% 100%;
animation:shimmer 3.5s infinite;
mix-blend-mode:screen;
pointer-events:none
}

/* ---------- UI ---------- */
.ui-layer{position:absolute;bottom:0;left:0;width:100%;height:35%;z-index:10;pointer-events:none;
display:flex;flex-direction:column;align-items:center;padding-top:20px}
#lyrics-container{width:85%;text-align:center;position:relative;height:60px}
.lyric-line{
position:absolute;width:100%;top:50%;left:50%;
transform:translate(-50%,-50%) scale(.95);
font-size:clamp(1rem,4.5vw,1.4rem);
line-height:1.4;color:rgba(255,255,255,.05);
transition:all .6s ease;filter:blur(6px);opacity:0;white-space:nowrap
}
.lyric-line.active{
color:#fff;transform:translate(-50%,-50%) scale(1.05);
filter:blur(0);opacity:1;text-shadow:0 0 20px rgba(255,255,255,.3)
}
.progress-container{position:absolute;bottom:0;left:0;width:100%;height:40px;z-index:100;cursor:pointer;display:flex;align-items:flex-end}
.progress-bg{width:100%;height:2px;background:rgba(255,255,255,.1)}
.progress-bar{width:0%;height:100%;background:linear-gradient(90deg,var(--p),var(--s));box-shadow:0 0 10px var(--p)}
</style>
</head>

<body>

<div id="overlay">
  <div class="cover">
    <div class="l1"><span>LOVE STORY</span></div>
    <div class="l2"><span>of</span></div>
    <div class="l3"><span>FRANK & YELLOWEASTSUN</span></div>
  </div>
</div>

<canvas id="mainCanvas"></canvas>

<div class="ui-layer"><div id="lyrics-container"></div></div>
<div class="progress-container" id="p-touch">
  <div class="progress-bg"><div class="progress-bar" id="p-bar"></div></div>
</div>

<audio id="music" src="Love Story.mp3" preload="auto"></audio>

<script>
/* =========================================================
   基础环境
========================================================= */
const canvas=document.getElementById('mainCanvas');
const ctx=canvas.getContext('2d',{alpha:false});
const audio=document.getElementById('music');
const overlay=document.getElementById('overlay');
const lyricsWrap=document.getElementById('lyrics-container');
const pBar=document.getElementById('p-bar');

let ww,wh,cx,cy,baseSize;
let dpr=Math.min(devicePixelRatio||1,2);

/* 音频 */
let audioCtx,analyser,dataArray;
let audioEnergy=0,heartbeat=0;

/* 交互 */
let targetX=0,targetY=0,mouseX=0,mouseY=0;

/* =========================================================
   Resize
========================================================= */
function resize(){
ww=innerWidth;wh=innerHeight;
canvas.width=Math.round(ww*dpr);
canvas.height=Math.round(wh*dpr);
ctx.setTransform(dpr,0,0,dpr,0,0);
cx=ww/2;cy=wh*0.42;
baseSize=Math.min(ww,wh)/50;
}
resize();addEventListener('resize',resize);

/* =========================================================
   心形路径（含法线）
========================================================= */
const PRECISION=1000;
let heartPath=[];
function generateHeartPath(){
heartPath=[];
for(let i=0;i<PRECISION;i++){
const t=i/PRECISION*Math.PI*2;
const x=16*Math.pow(Math.sin(t),3);
const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
heartPath.push({x,y,nx:0,ny:0});
}
for(let i=0;i<PRECISION;i++){
const p=heartPath[(i-1+PRECISION)%PRECISION];
const n=heartPath[(i+1)%PRECISION];
const tx=n.x-p.x,ty=n.y-p.y;
const len=Math.hypot(tx,ty)||1;
heartPath[i].nx=-ty/len;
heartPath[i].ny= tx/len;
}
}
generateHeartPath();

/* =========================================================
   Morph 粒子（封面 → 心脏）
========================================================= */
let morphParticles=[];
let morphActive=true;

function sampleCoverText(){
ctx.clearRect(0,0,ww,wh);
ctx.fillStyle="#fff";ctx.textAlign="center";
ctx.font="48px Cinzel";ctx.fillText("LOVE STORY",cx,cy-42);
ctx.font="22px Cinzel";ctx.fillText("of",cx,cy);
ctx.font="32px Cinzel";ctx.fillText("FRANK & YELLOWEASTSUN",cx,cy+42);
const img=ctx.getImageData(0,0,ww,wh).data;

for(let y=0;y<wh;y+=6){
for(let x=0;x<ww;x+=6){
if(img[(y*ww+x)*4+3]>20){
morphParticles.push({x,y});
}
}
}
}
sampleCoverText();

/* =========================================================
   心脏粒子系统（你认可版本）
========================================================= */
let particles=[];
const heartRateBase=.55;

class Particle{
constructor(){
this.index=Math.random()*PRECISION;
this.speed=Math.random()*.6+.6;
const g=Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random());
this.sign=Math.random()>.5?1:-1;
this.baseOffset=Math.abs(g)*6+2;
this.size=Math.random()*1.6+.6;
this.hue=Math.random()>.75?345:20;
this.alpha=Math.random()*.4+.15;
this.x=cx;this.y=cy;
}
update(){
this.index=(this.index+heartRateBase*this.speed+heartbeat*6*this.speed)%PRECISION;
const p=heartPath[Math.floor(this.index)];
const pulse=1+heartbeat*.6;
const tx=p.x*baseSize*pulse;
const ty=p.y*baseSize*pulse;
const offset=this.baseOffset*(1+heartbeat*1.6);
const dx=p.nx*(this.sign*offset);
const dy=p.ny*(this.sign*offset);
const destX=cx+tx+dx+mouseX*12;
const destY=cy+ty+dy+mouseY*12;
this.x+=(destX-this.x)*.14;
this.y+=(destY-this.y)*.14;
this.drawSize=this.size*(1+heartbeat*.35);
this.drawAlpha=this.alpha*(1+heartbeat*1.4);
}
draw(){
ctx.globalCompositeOperation="lighter";
ctx.fillStyle=`hsla(${this.hue},80%,${60+heartbeat*12}%,${this.drawAlpha})`;
ctx.beginPath();
ctx.arc(this.x,this.y,this.drawSize,0,Math.PI*2);
ctx.fill();
}
}

for(let i=0;i<2500;i++)particles.push(new Particle());

/* =========================================================
   歌词
========================================================= */
const timeline=[{t:0,text:"Lubricate & East Sun"},{t:12,text:"Lubricate stands in the soft glow"},{t:20,text:"Frank calls, 'Don't move too slow.'"},
{t:25,text:"East Sun smiles through broken tunes"},{t:31,text:"Promises we made too soon"},
{t:37,text:"Frank and East Sun, staying young"},{t:43,text:"Every truth still on our tongue"},
{t:51,text:"Oh, Lubricate and East Sun run"},{t:58,text:"Through the dark into the sun"},
{t:67,text:"I choose you — East Sun"}];

timeline.forEach((l,i)=>{
const d=document.createElement('div');
d.className='lyric-line';d.id='l-'+i;
d.innerText=l.text;lyricsWrap.appendChild(d);
});

/* =========================================================
   交互 & 音频
========================================================= */
addEventListener('mousemove',e=>{
targetX=e.clientX/ww-.5;
targetY=e.clientY/wh-.5;
});

overlay.onclick=()=>{
audioCtx=new AudioContext();
analyser=audioCtx.createAnalyser();
analyser.fftSize=128;
dataArray=new Uint8Array(analyser.frequencyBinCount);
audioCtx.createMediaElementSource(audio).connect(analyser);
analyser.connect(audioCtx.destination);
audio.play();
overlay.style.opacity=0;
setTimeout(()=>overlay.remove(),1200);
};

/* =========================================================
   主循环
========================================================= */
function animate(){
mouseX+=(targetX-mouseX)*.05;
mouseY+=(targetY-mouseY)*.05;

ctx.globalCompositeOperation="source-over";
ctx.fillStyle="#050505";
ctx.fillRect(0,0,ww,wh);

if(analyser){
analyser.getByteFrequencyData(dataArray);
let s=0;for(let i=0;i<12;i++)s+=dataArray[i];
audioEnergy=s/12/255;
heartbeat=Math.pow(audioEnergy,1.7);
}

if(morphActive){
morphParticles.forEach(p=>{
const idx=Math.floor(Math.random()*PRECISION);
const h=heartPath[idx];
const tx=cx+h.x*baseSize;
const ty=cy+h.y*baseSize;
p.x+=(tx-p.x)*.06;
p.y+=(ty-p.y)*.06;
ctx.fillStyle="rgba(255,120,160,.8)";
ctx.beginPath();ctx.arc(p.x,p.y,1.2,0,Math.PI*2);ctx.fill();
});
morphParticles.length*=.985;
if(morphParticles.length<40)morphActive=false;
}else{
particles.forEach(p=>{p.update();p.draw();});
}

/* 歌词 */
const idx=timeline.findIndex((l,i)=>audio.currentTime>=l.t&&(!timeline[i+1]||audio.currentTime<timeline[i+1].t));
if(idx!==-1){
document.querySelectorAll('.lyric-line').forEach(l=>l.classList.remove('active'));
document.getElementById('l-'+idx)?.classList.add('active');
}

/* 进度 */
if(audio.duration)pBar.style.width=`${audio.currentTime/audio.duration*100}%`;

requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>